<!DOCTYPE html>
<html>
<head>
    <title>Register</title>
    <link rel="stylesheet" type="text/css" href="/css/home.css">
    <link rel="stylesheet" type="text/css" href="/css/register.css">

</head>
<body>
<nav>
    <div class="wrapper">
        <div class="logo"><a href="/">Animal Shelter</a></div>
        <ul class="nav-links">
            <li><a href="/forum">Forum</a></li>
            <li><a href="/feedback">Feedback</a></li>
        </ul>
    </div>
</nav>

<main>
    <div class="left-side-reg"></div>
    <div class="right-side">
        <h1>Register</h1>
        {{if .ErrorMessage}}
        <div class="error-message">{{.ErrorMessage}}</div>
        {{end}}

        <form id="registrationForm" action="/register" method="post" enctype="multipart/form-data">
            <!-- First Step -->
            <div id="step1">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required><br>

                <label for="phone_number">Phone Number:</label>
                <input type="text" id="phone_number" name="phone_number" placeholder="+996 " required><br>

                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required><br>

                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required><br>



                <label for="confirm_password">Confirm Password:</label>
                <input type="password" id="confirm_password" name="confirm_password" required><br>
                <div id="password-strength" class="strength-bar">
                    <span id="strength-text"></span>
                </div>
                <div id="fillStep" style="color: #2f34ab;font-weight: bold; display: none;">Please fill out all fields</div>
                <button type="button" class="login-btn" onclick="nextStep(1)">Next</button>
                <p>Already have an account? <a href="/login">Login here</a>.</p>
            </div>

            <!-- Second Step -->
            <div id="step2" style="display:none;">
                <h4>Add more information about Yourself</h4>
                <label for="first_name">First Name:</label>
                <input type="text" id="first_name" name="first_name" required><br>

                <label for="last_name">Last Name:</label>
                <input type="text" id="last_name" name="last_name" required><br>

                <label for="date_of_birth">Date of Birth:</label>
                <input type="date" id="date_of_birth" name="date_of_birth" required><br>

                <label for="bio">Bio:</label>
                <input type="text" id="bio" name="bio" required><br>

                <label for="profile_image">Profile Image:</label>
                <div class="file-upload-container">
                    <input type="file" id="profile_image" name="profile_image" style="display:none;">
                    <button type="button" class="login-btn" onclick="document.getElementById('profile_image').click();">Upload Profile Image</button>
                    <span id="file-chosen">No file chosen</span>
                </div><br>

                <input type="submit" class="login-btn" value="Register">
            </div>
        </form>

    </div>

</main>



</body>

<script>
    document.getElementById('profile_image').addEventListener('change', function() {
        const fileName = this.files[0].name;
        const fileChosen = document.getElementById('file-chosen');

        fileChosen.textContent = fileName.length > 20 ? fileName.substring(0, 13) + '...' : fileName;
        fileChosen.setAttribute('title', fileName);  // Add the full file name as title for tooltip
    });

    function nextStep(step) {
        const currentStep = document.getElementById(`step${step}`);
        const nextStep = document.getElementById(`step${step + 1}`);
        const errorMessage = document.getElementById('fillStep');

        // Check if all required fields in the current step are filled out
        const requiredFields = currentStep.querySelectorAll('[required]');
        let allFieldsFilled = true;

        requiredFields.forEach(function(field) {
            if (!field.value.trim()) {
                allFieldsFilled = false;
            }
        });

        if (allFieldsFilled) {
            // Hide error message and move to the next step
            errorMessage.style.display = 'none';
            currentStep.style.display = 'none';
            nextStep.style.display = 'block';
        } else {
            // Show error message
            errorMessage.style.display = 'block';
        }
    }

    // Enable the "Next" button only when all fields are filled
    document.addEventListener("DOMContentLoaded", function() {
        const form = document.getElementById('registrationForm');
        const nextButton = form.querySelector('.login-btn');

        form.addEventListener('input', function() {
            const requiredFields = form.querySelectorAll('#step1 [required]');
            let allFieldsFilled = true;

            requiredFields.forEach(function(field) {
                if (!field.value.trim()) {
                    allFieldsFilled = false;
                }
            });

            nextButton.disabled = !allFieldsFilled;  // Disable the button if any required field is empty
        });
    });

    document.addEventListener("DOMContentLoaded", function() {
        const phoneNumberInput = document.getElementById('phone_number');

        phoneNumberInput.value = '+996 ';

        phoneNumberInput.addEventListener('input', function(e) {
            let input = e.target.value.replace(/\D/g, ''); // Remove all non-digit characters

            if (!input.startsWith('996')) {
                input = '996' + input;
            }

            input = input.slice(0, 13);

            let formattedNumber = '+996 ';
            if (input.length > 3) {
                formattedNumber += input.slice(3, 6);  // XXX
            }
            if (input.length > 6) {
                formattedNumber += ' ' + input.slice(6, 8);  // XX
            }
            if (input.length > 8) {
                formattedNumber += ' ' + input.slice(8, 10);  // XX
            }
            if (input.length > 10) {
                formattedNumber += ' ' + input.slice(10, 12);  // XX
            }

            e.target.value = formattedNumber;
        });

        phoneNumberInput.addEventListener('focus', function() {
            if (phoneNumberInput.value === '') {
                phoneNumberInput.value = '+996 ';
            }
        });

        phoneNumberInput.addEventListener('blur', function() {
            if (phoneNumberInput.value === '+996 ') {
                phoneNumberInput.value = '';
            }
        });
    });

    document.addEventListener("DOMContentLoaded", function() {
        const dateOfBirthInput = document.getElementById('date_of_birth');
        const today = new Date().toISOString().split('T')[0];
        dateOfBirthInput.setAttribute('max', today);
    });
    document.addEventListener("DOMContentLoaded", function() {
        const navbar = document.querySelector('nav');
        let lastScrollTop = 0;

        window.addEventListener('scroll', function() {
            let currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;

            if (currentScrollTop > lastScrollTop) {
                // Scrolling down
                navbar.classList.add('nav-hidden');
            } else {
                // Scrolling up
                navbar.classList.remove('nav-hidden');
            }

            lastScrollTop = currentScrollTop <= 0 ? 0 : currentScrollTop; // For Mobile or negative scrolling
        });
    });
    document.getElementById('password').addEventListener('input', function() {
        const password = this.value;
        const strengthBar = document.getElementById('password-strength');
        const strengthText = document.getElementById('strength-text');

        // Если поле пароля пустое, скрываем индикатор и текст
        if (!password) {
            strengthBar.style.display = 'none';
            strengthText.style.display = 'none';
            return;
        }

        // Показать индикатор и текст, если есть значение
        strengthBar.style.display = 'block';
        strengthText.style.display = 'block';

        // Оценка силы пароля
        const strength = evaluatePasswordStrength(password);

        // Обновляем текст, ширину полосы и цвет текста
        let strengthIndicator = strengthBar.querySelector('span');
        if (!strengthIndicator) {
            strengthIndicator = document.createElement('span');
            strengthBar.appendChild(strengthIndicator);
        }

        if (strength === 'weak') {
            strengthIndicator.className = 'weak';
            strengthIndicator.style.width = '33%';
            strengthText.textContent = 'Weak';
            strengthText.style.color = 'red';
        } else if (strength === 'medium') {
            strengthIndicator.className = 'medium';
            strengthIndicator.style.width = '66%';
            strengthText.textContent = 'Medium';
            strengthText.style.color = 'orange';
        } else if (strength === 'strong') {
            strengthIndicator.className = 'strong';
            strengthIndicator.style.width = '100%';
            strengthText.textContent = 'Strong';
            strengthText.style.color = 'green';
        }
    });

    // Функция для оценки силы пароля
    function evaluatePasswordStrength(password) {
        let strength = 'weak';
        const lengthCriteria = password.length >= 8;
        const numberCriteria = /\d/.test(password);
        const specialCharCriteria = /[!@#$%^&*(),.?":{}|<>]/.test(password);

        if (lengthCriteria && numberCriteria && specialCharCriteria) {
            strength = 'strong';
        } else if (lengthCriteria && (numberCriteria || specialCharCriteria)) {
            strength = 'medium';
        }

        return strength;
    }



</script>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="/css/animal_list.css">
    <link rel="stylesheet" href="/css/forum.css">
    <link rel="stylesheet" href="/css/footer.css">
    <title>Forum</title>
</head>
<body>
<nav>
    <div class="wrapper">
        <div class="logo">
            <a href="/" class="logo-link">
                <img src="system_images/лого2.svg" alt="Logo Image" class="logo-image">
                <span class="logo-text">Animal Shelter</span>
            </a>
        </div>



        <ul class="nav-links">
            <li><a href="#">Feedback</a></li>
        </ul>
    </div>
</nav>

<div class="content-wrapper">
    <div class="welcome-wrapper">
        <div class="welcome-message">
            <img src="system_images/welcome cats.jpeg" alt="Welcome Image" class="welcome-image">
            <div class="welcome-text">
                <h1>Welcome to the Forum!</h1>
                <p>Feel free to explore and participate in our discussions.</p>
            </div>
        </div>
    </div>
    <div class="content-with-border">
        <h1>Topics
            <button class="BtnTopic" onclick="openModal()">
                <svg class="svgIconT" height="25px" width="25px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" xml:space="preserve" fill="#000000">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                <polygon style="fill:#F7F23E;" points="250.4,444.8 0,500 55.2,249.6 250.4,249.6 "></polygon>
                        <polygon style="fill:#F9D93D;" points="250.4,444.8 0,500 86.4,253.6 250.4,245.6 "></polygon>
                        <polyline style="fill:#E2B947;" points="250.4,249.6 250.4,444.8 0,500 "></polyline>
                        <polygon style="fill:#65CE21;" points="498.4,198.4 498.4,1.6 301.6,1.6 299.2,0 52.8,246.4 252.8,447.2 500,200.8 "></polygon>
                        <polygon style="fill:#0A597C;" points="85.6,414.4 24.8,388.8 0,500 111.2,475.2 "></polygon>
                        <polygon style="fill:#4EAF0E;" points="498.4,198.4 498.4,1.6 351.2,1.6 80,273.6 252.8,447.2 500,200.8 "></polygon>
                        <polygon style="fill:#3F9109;" points="412,1.6 110.4,304 196,389.6 498.4,88 498.4,1.6 "></polygon>
                        <polyline style="fill:#022B3A;" points="0,500 111.2,475.2 85.6,414.4 "></polyline>
            </g>
        </svg>
                <span class="text">New topic</span>
            </button>
        </h1>



        <div id="newTopicModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2 style="display: flex; align-items: center;">
                    Create New Topic
                    <svg viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" fill="#000000" width="34" height="34" style="margin-left: 8px;">
                        <g id="color">
                            <path fill="#6A462F" stroke="none" d="M24.7544,17.9188l-6.6667-5.3333l-8.1667,1l-3,4.6667l0.5,6.6667l3.8333,5.8333 c0,0,1.8333,1.1667,2.6667,1.6667l-2.5,7.6667l-0.3333,6.3333l1.5,5.5l2.8333,3.6667l5.5,3.8333c0,0,15.6667,9,30.6667,0.1667 l5.8333-4.8333l3.1667-6l0.6667-4.6667l-1.3333-8.8333l-1.6667-2.5l2.8333-2.1667l2.5-4.8333l1.6667-5.3333l-1.6667-5l-4.3333-3 l-4.1667-0.1667l-6,3.8333l-1.3333,1.5l-8.3333-1.6667h-8.1667L24.7544,17.9188z"></path>
                            <path fill="#A57939" stroke="none" d="M29.5877,37.7521l-2,5l-0.8333,6.6667l2,3.1667l0.3333,4.3333l2.8333,2.1667l8.6667-0.3333l2.3333-1 l0.1667-5.1667l2-3.1667l-1.1667-6.6667l-2.5-5.5C41.421,37.2521,34.421,32.4188,29.5877,37.7521z"></path>
                            <path fill="#3F3F3F" stroke="none" d="M30.7544,47.7521c0,0,4.3333-4.6667,9.8333-0.3333l-1.8333,2.8333l-6-0.1667L30.7544,47.7521z"></path>
                            <path fill="#A57939" stroke="none" d="M47.7544,18.4188c0,0,12.8333-4,15.1667,8l2-4l-0.1667-5.5l-3.5-3.8333l-5.5-1.3333l-5.5,3.6667 L47.7544,18.4188z"></path>
                            <path fill="#A57939" stroke="none" d="M24.2544,18.4188c0,0-12.8333-4-15.1667,8l-2-4l0.1667-5.5l3.5-3.8333l5.5-1.3333l5.5,3.6667 L24.2544,18.4188z"></path>
                        </g>
                        <g id="line">
                            <circle cx="28.6339" cy="36.999" r="2" fill="#000000" stroke="none"></circle>
                            <path fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" d="M26.0089,19.8949c0,0-7.6875-11.625-14.9375-6.8125c-6.6011,4.3818-3.9113,13.9584,0.603,16.915"></path>
                            <path fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" d="M21.0714,58.5824c-15.9375-6.3125-7.8506-24.0133-7.8506-24.0133s3.645-9.3586,9.3416-11.6086"></path>
                            <path fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" d="M51.0978,58.5824c15.9375-6.3125,7.8506-24.0133,7.8506-24.0133s-3.645-9.3586-9.3416-11.6086"></path>
                            <circle cx="43.3661" cy="36.999" r="2" fill="#000000" stroke="none"></circle>
                            <path fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" d="M43.495,43.3313l1.5607,4.8039c0.2196,0.8168,0.0853,1.6816-0.3675,2.3961c-1.2194,1.924-4.0542,5.1185-8.2597,2.2386h-0.8572 c-4.2055,2.8798-7.0402-0.3147-8.2597-2.2386c-0.4528-0.7144-0.5871-1.5793-0.3675-2.3961l1.5607-4.8039"></path>
                            <path fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" d="M40.172,47.9243c-0.1014,3.008-2.8052,1.6561-2.8052,1.6561L36,48.9038l-1.3667,0.6766c0,0-2.7039,1.3519-2.8052-1.6561"></path>
                            <path fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" d="M45.9911,19.8949c0,0,7.6875-11.625,14.9375-6.8125c6.6011,4.3818,3.9113,13.9584-0.603,16.915"></path>
                            <path fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" d="M29.9464,57.1478c0,0,5.1875,6.6013,12.1072,0.5625"></path>
                            <path fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" d="M24.6652,17.9512c0,0,8.7098-4.9304,22.3259,0"></path>
                            <line x1="36" x2="36" y1="52.7699" y2="49.5804" fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2"></line>
                        </g>
                    </svg>
                </h2>

                <form id="newTopicForm" method="POST" action="/create_topic">
                    <input type="text" id="title" name="title" required maxlength="50" placeholder="Enter the topic title">

                    <input type="text" id="description" name="description" rows="4" required maxlength="500" placeholder="Enter the description">

                    <div id="errorMessage" style="color: red; display: none;">You can create a maximum of 10 topics.</div>
                    <button class="createTopic" type="submit">Create Topic</button>
                </form>
            </div>
        </div>




        <div class="discussions-wrapper">
        <div class="hot-discussion">
            <h2>Hottest Discussions</h2>
            <ul>
                {{range $index, $topic := .HottestTopics}}
                <li class="topic">
                    <div class="user-info">
                        <img src="{{$topic.ProfileImage}}" alt="Profile Image" class="profile-image" onerror="this.onerror=null;this.src='https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png';">
                        <span class="username">{{$topic.Username}}</span>
                        <span class="created-at">{{$topic.CreatedAt}}</span>
                    </div>
                    <a href="/topic?id={{$topic.ID}}" class="topic-title">{{$topic.Title}}</a>
                    <span class="responses">Responses: {{$topic.ResponseCount}}</span>
                    <img src="system_images/fire.png" alt="Popular" class="fire-icon">
                </li>
                {{end}}
            </ul>
        </div>
            <div class="your-topics">
                <h2>Your Topics</h2>
                {{if .UserLoggedIn}}
                <div class="user-profile" style="background-image: url('{{.User.BgImage}}');">
                    <div class="profile-inner">
                        <a href="/profile">
                            <img src="{{.User.ProfileImage}}" alt="Profile Image" class="profile-image" onerror="this.onerror=null;this.src='https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png';">
                        </a>
                        <div class="username-info">
                            <div class="username">{{.User.Username}}</div>
                            <div class="topic-count">Total topics: {{len .User.Topics}}</div>
                        </div>
                    </div>
                </div>
                <button onclick="openModalTopic()">View Topics</button>
                {{if .User.Topics}}
                <ul>
                    {{range .User.Topics}}
                    <li class="topic">
                        <a href="/topic?id={{.ID}}" class="topic-title">{{.Title}}</a>
                    </li>
                    {{end}}
                </ul>
                {{else}}
                <p>You have no topics created yet.</p>
                {{end}}
                {{else}}
                <p>You need to <a href="/login">login</a> to see your topics.</p>
                {{end}}
            </div>

            <div id="topicsModal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeModalTopic()">&times;</span>
                    <h2>Select topics to delete</h2>

                    {{if .User.Topics}}
                    <!-- Форма для удаления топиков с чекбоксами -->
                    <form method="POST" action="/delete-topics" onsubmit="return validateForm()">
                        <div class="topics-list">
                            <div class="column">
                                {{range .User.Topics}}
                                <div class="topic-wrapper">
                                    <label class="checkbox-wrapper-31">
                                        <input type="checkbox" name="topic_ids[]" value="{{.ID}}">
                                        <svg viewBox="0 0 35.6 35.6">
                                            <circle class="background" cx="17.8" cy="17.8" r="17.8"></circle>
                                            <circle class="stroke" cx="17.8" cy="17.8" r="14.37"></circle>
                                            <polyline class="check" points="11.78 18.12 15.55 22.23 25.17 12.87"></polyline>
                                        </svg>
                                    </label>
                                    <li class="topic">
                                        <a href="/topic?id={{.ID}}" class="topic-title">{{.Title}}</a>
                                    </li>
                                </div>
                                {{end}}
                            </div>
                        </div>

                        <!-- Сообщение об ошибке, если не выбран ни один чекбокс -->
                        <div id="error-message" style="color: red; display: none;">
                            Please select at least one topic to delete
                        </div>

                        <!-- Кнопка подтверждения удаления -->
                        <button class="delete-button" type="submit">
                            <p class="paragraph"> delete </p>
                            <span class="icon-wrapper">
                    <svg class="icon" width="30px" height="30px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 7V18C6 19.1046 6.89543 20 8 20H16C17.1046 20 18 19.1046 18 18V7M6 7H5M6 7H8M18 7H19M18 7H16M10 11V16M14 11V16M8 7V5C8 3.89543 8.89543 3 10 3H14C15.1046 3 16 3.89543 16 5V7M8 7H16" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </span>
                        </button>
                    </form>
                    {{else}}
                    <p>You have no topics created yet.</p>
                    {{end}}
                </div>
            </div>

        </div>

    <div class="search-wrapper" id="search-section">
        <div class="search-field">
            <input type="text" id="topic-search" class="search-input" placeholder="Search by topic title...">
            <button class="search-button" onclick="searchTopics()">Search</button>
            <button class="search-button recent-button">Recent</button>
        </div>
    </div>
    {{if eq (len .Topics) 0}}
    <div class="no-result">
        <img src="system_images/Not found cat.jpeg" alt="No Results" class="no-result-image">
        <p class="no-result-text">Um, sorry, I didn't find anything :(</p>
        <p class="no-result-small-text" style="color: gray; font-size: small;">(Search inspector - Aidar.
            Yes, he works at two jobs)</p>
    </div>
    {{else}}
    <ul>
        {{range $topic := .Topics}}
        <li class="topic">
            <div class="user-info">
                <img src="{{$topic.ProfileImage}}" alt="Profile Image" class="profile-image" onerror="this.onerror=null;this.src='https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png';">
                <span class="username">{{$topic.Username}}</span>
                <span class="created-at">{{$topic.CreatedAt}}</span>
            </div>
            <a href="/topic?id={{$topic.ID}}" class="topic-title">{{$topic.Title}}</a>
            <span class="responses">Responses: {{$topic.ResponseCount}}</span>
        </li>
        {{end}}
    </ul>
    {{end}}

    <div class="pagination">
        {{- range .Pages -}}
        {{- if eq .Number "..." -}}
        <img src="system_images/paw for pages.png" alt="..." class="pagination-icon">
        {{- else -}}
        <a href="{{.URL}}#search-section" class="page-number {{if .IsActive}}active{{end}}">
            {{.Number}}
        </a>
        {{- end -}}
        {{- end -}}
    </div>




</div>
</div>
<!-- Site footer -->
<footer class="site-footer">
    <div class="footer-links-container">
        <div class="footer-links">
            <h6>About</h6>
            <p>We are a non-profit organization dedicated to animal rescue and adoption.</p>
        </div>
        <div class="footer-links">
            <h6>Categories</h6>
            <ul>
                <li><a href="/animal_list?species=1">Dogs</a></li>
                <li><a href="/animal_list?species=2">Cats</a></li>
                <li><a href="/animal_list?species=3">Birds</a></li>
            </ul>
        </div>
        <div class="footer-links">
            <h6>Quick Links</h6>
            <ul>
                <li><a href="/register">Register</a></li>
                <li><a href="#">Adopt</a></li>
                <li><a href="/forum">Forum</a></li>
                <li><a href="/terms-of-service">User Agreement</a></li>
            </ul>
        </div>
    </div>
    <hr>
    <div class="footer-bottom">
        <p>&copy; 2024 Animal Shelter. All rights reserved.</p>
        <button class="Btn">
            <svg class="svgIcon" viewBox="0 0 496 512" height="1.4em" xmlns="http://www.w3.org/2000/svg">
                <path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
            <span class="text">Github</span>
        </button>
        <button class="Btn">
            <svg class="svgIcon" viewBox="0 0 496 512" height="1.4em" xmlns="http://www.w3.org/2000/svg">
                <path d="M248,8C111.033,8,0,119.033,0,256s111.033,248,248,248s248-111.033,248-248S384.967,8,248,8z M362.235,153.392 L325.716,335.721c-3.948,17.96-14.463,22.394-29.329,13.953l-81.141-59.765l-39.115,37.61c-4.328,4.328-7.957,7.957-16.22,7.957l5.807-82.641 l149.494-134.93c6.537-5.809-1.467-9.071-10.122-3.262L153.299,259.185l-81.126-25.391c-17.589-5.491-17.96-17.589,3.689-26.013 L345.66,133.424C356.071,129.615,366.494,137.046,362.235,153.392z"></path>
            </svg>
            <span class="text">Telegram</span>
        </button>

    </div>
</footer>

</body>
<script>
    const titleInput = document.getElementById('topic-search');
    function searchTopics() {
        const title = titleInput.value;
        const url = new URL(window.location.href);

        // Set search title if exists, otherwise delete it
        if (title) {
            url.searchParams.set('title', title);
        } else {
            url.searchParams.delete('title');
        }

        // Always reset page to 1 on search
        url.searchParams.set('page', '1');

        // Redirect to the modified URL
        window.location.href = url.toString();
    }


    document.addEventListener("DOMContentLoaded", function() {
        const navbar = document.querySelector('nav');
        let lastScrollTop = 0;

        window.addEventListener('scroll', function() {
            let currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;

            if (currentScrollTop > lastScrollTop) {
                navbar.classList.add('nav-hidden');
            } else {
                navbar.classList.remove('nav-hidden');
            }

            lastScrollTop = currentScrollTop <= 0 ? 0 : currentScrollTop;
        });
    });
    function openModal() {
        document.getElementById("newTopicModal").style.display = "block";
    }

    function closeModal() {
        document.getElementById("newTopicModal").style.display = "none";
    }

    // Закрытие модального окна при клике вне его
    window.onclick = function(event) {
        const modal = document.getElementById("newTopicModal");
        if (event.target === modal) {
            closeModal();
        }
    }
    document.getElementById("newTopicForm").onsubmit = async function (event) {
        event.preventDefault(); // Предотвращает отправку формы

        const response = await fetch('/create_topic', {
            method: 'POST',
            body: new FormData(this)
        });

        if (response.status === 403) { // Если достигнут лимит
            document.getElementById("errorMessage").style.display = 'block';
        } else {
            window.location.href = '/forum'; // Переход на страницу форума при успехе
        }
    };
    function openModalTopic() {
        document.getElementById('topicsModal').style.display = 'block';
    }

    // Функция для закрытия модального окна
    function closeModalTopic() {
        document.getElementById('topicsModal').style.display = 'none';
    }

    // Закрыть модальное окно при нажатии вне его
    window.onclick = function(event) {
        const modal = document.getElementById('topicsModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
    function validateForm() {
        // Проверяем, что хотя бы один чекбокс выбран
        const checkboxes = document.querySelectorAll('input[name="topic_ids[]"]:checked');
        if (checkboxes.length === 0) {
            // Показываем сообщение об ошибке
            document.getElementById('error-message').style.display = 'block';
            return false; // Отправка формы не произойдет
        }
        // Скрываем сообщение об ошибке, если чекбокс выбран
        document.getElementById('error-message').style.display = 'none';
        return true; // Форма будет отправлена
    }
    document.addEventListener("DOMContentLoaded", function() {
        const topicTitles = document.querySelectorAll(".topic-title");

        topicTitles.forEach(title => {
            if (title.textContent.length > 18) {
                title.textContent = title.textContent.slice(0, 18) + "...";
            }
        });
    });
</script>
</html>
